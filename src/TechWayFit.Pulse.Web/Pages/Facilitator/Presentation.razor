@page "/facilitator/live/presentation"
@layout PresentationModeLayout
@attribute [Microsoft.AspNetCore.Authorization.Authorize]
@using TechWayFit.Pulse.Contracts.Enums
@using TechWayFit.Pulse.Web.Components.Presentation
@using TechWayFit.Pulse.Web.Components.Facilitator

<PageTitle>Presentation Mode - @(session?.Title ?? "TechWayFit Pulse")</PageTitle>

<LiveQRModal SessionCode="@SessionCode"
             JoinUrl="@joinUrl"
             OnCopyUrl="@CopyJoinUrl" />

@if (isLoading)
{
    <div class="presentation-container">
        <div class="presentation-content">
            <div class="activity-display">
                <div class="waiting-state">
                    <i class="ics ics-hourglass waiting-icon"></i>
                    <h3>Loading presentation...</h3>
                    <p>Please wait</p>
                </div>
            </div>
        </div>
    </div>
}
else
{
    <PresentationLayout
        Title="Presentation Mode"
        SessionTitle="@SessionTitle"
        SessionCode="@SessionCode"
        SessionTTL="@SessionTTL"
        ParticipantCount="@participantCount"
        ShowFooter="true"
        CurrentActivityNumber="@CurrentActivityNumber"
        TotalActivities="@TotalActivities"
        HasPrevious="@hasPrevious"
        HasNext="@hasNext"
        OnExit="@ExitPresenterMode"
        OnPrevious="@GoBack"
        OnNext="@MoveNext">

        <HeaderButtons>
            <button type="button" class="control-btn" @onclick="ShowQRModal">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M2 2H6V6H2V2Z" stroke="currentColor" stroke-width="1.5" />
                    <path d="M10 2H14V6H10V2Z" stroke="currentColor" stroke-width="1.5" />
                    <path d="M2 10H6V14H2V10Z" stroke="currentColor" stroke-width="1.5" />
                    <path d="M10 10H11V11H10V10Z" fill="currentColor" />
                    <path d="M12 10H13V11H12V10Z" fill="currentColor" />
                    <path d="M13 11H14V12H13V11Z" fill="currentColor" />
                    <path d="M10 12H11V13H10V12Z" fill="currentColor" />
                    <path d="M12 12H13V13H12V12Z" fill="currentColor" />
                    <path d="M13 13H14V14H13V13Z" fill="currentColor" />
                </svg>
                Join Instructions
            </button>
        </HeaderButtons>

        <FooterButtons>
            @if (activity != null)
            {
                @if (activity.Status == ActivityStatus.Open)
                {
                    <button class="nav-btn activity-action-btn activity-action-complete" @onclick="CompleteCurrentActivity" disabled="@isPerformingAction">
                        @(isPerformingAction ? "Completing..." : "Complete")
                    </button>
                }
                else
                {
                    <button class="nav-btn activity-action-btn @(activity.Status == ActivityStatus.Closed ? "activity-action-restart" : "activity-action-start")" @onclick="ActivateCurrentActivity" disabled="@isPerformingAction">
                        @(isPerformingAction
                            ? "Starting..."
                            : activity.Status == ActivityStatus.Closed
                                ? "Restart"
                                : "Start")
                    </button>
                }
            }
        </FooterButtons>

        <ChildContent>
            @if (!string.IsNullOrEmpty(errorMessage))
            {
                <div class="activity-display">
                    <div class="waiting-state">
                        <i class="ics ics-warning waiting-icon"></i>
                        <h3>@errorMessage</h3>
                        <p>Please return to the live view</p>
                    </div>
                </div>
            }
            else if (activity != null)
            {
                @if (activity.Status != ActivityStatus.Open)
                {
                    <div class="alert alert-warning presentation-review-alert d-flex flex-nowrap align-items-center justify-content-between gap-3 mb-3" role="alert" aria-live="polite">
                        <div class="presentation-review-alert-body">
                            <div class="presentation-review-alert-title">Review Mode</div>
                            <div class="presentation-review-alert-text">
                                Status: @activity.Status
                                @(activity.Status == ActivityStatus.Closed
                                    ? " — This activity is closed and visible in review mode."
                                    : " — This activity is pending and visible in review mode.")
                            </div>
                        </div>
                    </div>
                }

                @if (activity.Type == ActivityType.Poll)
                {
                    <PollPresentation 
                        SessionCode="@SessionCode" 
                        ActivityId="@activity.ActivityId"
                        ActivityTitle="@activity.Title"
                        ActivityPrompt="@activity.Prompt"
                        DurationMinutes="@activity.DurationMinutes"
                        OpenedAt="@activity.OpenedAt" />
                }
                else if (activity.Type == ActivityType.WordCloud)
                {
                    <WordCloudPresentation 
                        SessionCode="@SessionCode" 
                        ActivityId="@activity.ActivityId"
                        ActivityTitle="@activity.Title"
                        ActivityPrompt="@activity.Prompt"
                        DurationMinutes="@activity.DurationMinutes"
                        OpenedAt="@activity.OpenedAt" />
                }
                else if (activity.Type == ActivityType.Rating)
                {
                    <RatingPresentation 
                        SessionCode="@SessionCode" 
                        ActivityId="@activity.ActivityId"
                        ActivityTitle="@activity.Title"
                        ActivityPrompt="@activity.Prompt"
                        DurationMinutes="@activity.DurationMinutes"
                        OpenedAt="@activity.OpenedAt"
                        MaxRating="5" />
                }
                else if (activity.Type == ActivityType.Quadrant)
                {
                    <QuadrantPresentation 
                        SessionCode="@SessionCode" 
                        ActivityId="@activity.ActivityId"
                        ActivityTitle="@activity.Title"
                        ActivityPrompt="@activity.Prompt"
                        DurationMinutes="@activity.DurationMinutes"
                        OpenedAt="@activity.OpenedAt"
                        ActivityConfig="@activity.Config" />
                }
                else if (activity.Type == ActivityType.GeneralFeedback)
                {
                    <GeneralFeedbackPresentation 
                        SessionCode="@SessionCode" 
                        ActivityId="@activity.ActivityId"
                        ActivityTitle="@activity.Title"
                        ActivityPrompt="@activity.Prompt"
                        DurationMinutes="@activity.DurationMinutes"
                        OpenedAt="@activity.OpenedAt" />
                }
                else
                {
                    <div class="activity-display">
                        <div class="waiting-state">
                            <i class="ics ics-info waiting-icon"></i>
                            <h3>Activity type not supported</h3>
                            <p>Presentation mode for @activity.Type activities is coming soon</p>
                        </div>
                    </div>
                }
            }
        </ChildContent>
    </PresentationLayout>
}