@page "/"
@inject IJSRuntime JS
@inject NavigationManager Navigation

<PageTitle>TechWayFit Pulse - Workshop Fun</PageTitle>

<!-- Top bar -->
<header class="topbar">
    <div class="row">
        <div class="brand">
            <div class="logo" aria-hidden="true"></div>
            <div class="name">
                <strong>Workshop Fun</strong>
                <span>Make workshops fun. Make insights measurable.</span>
            </div>
        </div>

        <div class="navbtns">
            <button class="btn ghost" @onclick='() => ShowScreen("home")'>Home</button>
            <button class="btn ghost" @onclick='() => ShowScreen("create")'>Create</button>
            <button class="btn ghost" @onclick='() => ShowScreen("live")'>Live Room</button>
            <button class="btn ghost" @onclick='() => ShowScreen("dash")'>Dashboards</button>
            <button class="btn ghost" @onclick='() => ShowScreen("p-join")'>Participant</button>
            <button class="btn primary" @onclick="OpenQrModal">QR / Link</button>
        </div>
    </div>
</header>

<!-- Screens -->
<main class="wrap">
    <!-- HOME -->
    <section class="screen @(currentScreen == "home" ? "active" : "")" id="home">
        <div class="grid">
            <div class="card">
                <div class="title">
                    <h1 class="h1">Run engaging workshops—without losing the data.</h1>
                    <span class="badge"><span class="dot"></span> Live-ready</span>
                </div>
                <p class="p">
                    Polls, word clouds, 4-quadrant matrices, and guided 5-Whys—designed to help people open up,
                    and help you leave with measurable outcomes.
                </p>

                <div class="kpis">
                    <div class="kpi"><strong>@SessionsCreated</strong><span>Sessions created</span></div>
                    <div class="kpi"><strong>@ParticipantsEngaged</strong><span>Participants engaged</span></div>
                    <div class="kpi"><strong>@ResponsesCollected</strong><span>Responses collected</span></div>
                </div>

                <div class="pillrow">
                    <span class="chip">✅ Anonymous optional</span>
                    <span class="chip">⚡ Real-time dashboards</span>
                    <span class="chip">🎯 "5 Whys" measurable output</span>
                    <span class="chip">🧠 AI-assisted follow-ups</span>
                </div>

                <div class="toolbar">
                    <button class="btn primary" @onclick='() => ShowScreen("create")'>Create a session</button>
                    <button class="btn" @onclick='() => ShowScreen("p-join")'>Join as participant</button>
                    <button class="btn" @onclick='() => ShowScreen("dash")'>See dashboards</button>
                </div>
            </div>

            <div class="card solid">
                <h2 class="h2">Starter templates</h2>
                <p class="p">Pick one and customize in 60 seconds.</p>

                <div class="list" style="margin-top:12px">
                    <div class="item @(selectedTemplate == "retro" ? "active" : "")" @onclick='() => SelectTemplate("retro")'>
                        <strong>Retro Sprint Review</strong><div>Quick pulse + themes + actions</div>
                    </div>
                    <div class="item @(selectedTemplate == "ops" ? "active" : "")" @onclick='() => SelectTemplate("ops")'>
                        <strong>Ops Pain Points</strong><div>Impact/Effort + 5-Whys</div>
                    </div>
                    <div class="item @(selectedTemplate == "discovery" ? "active" : "")" @onclick='() => SelectTemplate("discovery")'>
                        <strong>Product Discovery</strong><div>Idea cloud + prioritization</div>
                    </div>
                    <div class="item @(selectedTemplate == "incident" ? "active" : "")" @onclick='() => SelectTemplate("incident")'>
                        <strong>Incident Review</strong><div>Root cause ladder + fixes</div>
                    </div>
                </div>

                <div class="hr"></div>
                <div class="subtle">
                    Design language inspired by TechWayFit's clean, developer-first tone and card layout.
                </div>
            </div>
        </div>
    </section>

    <!-- CREATE (Wizard) -->
    <section class="screen @(currentScreen == "create" ? "active" : "")" id="create">
        <div class="card">
            <div class="title">
                <div>
                    <h2 class="h2">Create session</h2>
                    <div class="steps">
                        <span class="step @(currentWizardStep == 1 ? "active" : "")" @onclick="() => SetWizardStep(1)">1) Context</span>
                        <span class="step @(currentWizardStep == 2 ? "active" : "")" @onclick="() => SetWizardStep(2)">2) Join Form</span>
                        <span class="step @(currentWizardStep == 3 ? "active" : "")" @onclick="() => SetWizardStep(3)">3) Activities</span>
                        <span class="step @(currentWizardStep == 4 ? "active" : "")" @onclick="() => SetWizardStep(4)">4) Review</span>
                    </div>
                </div>
            </div>
            <span class="chip">TTL: <strong>&nbsp;6h</strong></span>
        </div>

        @if (currentWizardStep == 1)
        {
            <div class="grid">
                <div class="card solid" style="box-shadow:none">
                    <h3 class="h2">Session context</h3>
                    <div class="sp"></div>
                    <div class="form">
                        <div>
                            <label>Session title</label>
                            <input class="field" @bind="sessionTitle" />
                        </div>
                        <div>
                            <label>Goal</label>
                            <textarea class="field" rows="3" @bind="sessionGoal"></textarea>
                        </div>
                    </div>

                    <div class="toolbar">
                        <button class="btn primary" @onclick="() => SetWizardStep(2)">Next: Join Form</button>
                        <button class="btn" @onclick="NavigateToCreate">Go to Real Create Page</button>
                    </div>
                </div>

                <div class="card solid" style="box-shadow:none">
                    <h3 class="h2">Participant lobby preview</h3>
                    <p class="p">This is what participants see before joining.</p>

                    <div class="viz" style="margin-top:12px">
                        <div class="vizhead">
                            <div class="pulse"><span class="b"></span><strong>Session open</strong></div>
                            <span class="chip">Code: <strong>&nbsp;@sessionCode</strong></span>
                        </div>
                        <div class="subtle">@sessionTitle</div>
                        <div class="hr"></div>
                        <div class="subtle">Goal: @sessionGoal</div>
                        <div class="sp"></div>
                        <button class="btn primary" style="width:100%">Join</button>
                    </div>
                </div>
            </div>
        }
        else if (currentWizardStep == 2)
        {
            <div class="grid">
                <div class="card solid" style="box-shadow:none">
                    <h3 class="h2">Join form builder</h3>
                    <p class="p">Collect light profile fields for filtering and clustering later.</p>

                    <div class="list" style="margin-top:12px">
                        @foreach (var field in joinFields)
                        {
                            <div class="item">
                                <strong>@field.Name</strong>
                                <div>@field.Options</div>
                            </div>
                        }
                    </div>

                    <div class="toolbar">
                        <button class="btn" @onclick="() => SetWizardStep(1)">Back</button>
                        <button class="btn primary" @onclick="() => SetWizardStep(3)">Next: Activities</button>
                    </div>
                </div>

                <div class="card solid" style="box-shadow:none">
                    <h3 class="h2">Mobile join preview</h3>
                    <div class="viz" style="margin-top:12px">
                        <div class="subtle">Join session preview</div>
                        <div class="sp"></div>
                        @foreach (var field in joinFields.Take(2))
                        {
                            <div class="sp"></div>
                            <label>@field.Name</label>
                            <select class="field">
                                @foreach (var option in field.Options.Split(',').Take(3))
                                {
                                    <option>@option.Trim()</option>
                                }
                            </select>
                        }
                    </div>
                </div>
            </div>
        }
        else if (currentWizardStep == 3)
        {
            <div class="grid">
                <div class="card solid" style="box-shadow:none">
                    <h3 class="h2">Activities</h3>
                    <p class="p">Build a short agenda that alternates "fun" + "measurable".</p>

                    <div class="list">
                        @for (int i = 0; i < activities.Count; i++)
                        {
                            var index = i;
                            <div class="item @(selectedActivityIndex == index ? "active" : "")" @onclick="() => selectedActivityIndex = index">
                                <strong>@(index + 1)) @activities[index].Type</strong>
                                <div>@activities[index].Title</div>
                            </div>
                        }
                    </div>

                    <div class="toolbar">
                        <button class="btn" @onclick="AddActivity">+ Add activity</button>
                        <button class="btn" @onclick="() => SetWizardStep(2)">Back</button>
                        <button class="btn primary" @onclick="() => SetWizardStep(4)">Next: Review</button>
                    </div>
                </div>

                <div class="card solid" style="box-shadow:none">
                    <h3 class="h2">Configure selected activity</h3>
                    @if (selectedActivityIndex >= 0 && selectedActivityIndex < activities.Count)
                    {
                        var activity = activities[selectedActivityIndex];
                        <div class="form" style="margin-top:12px">
                            <div>
                                <label>Activity title</label>
                                <input class="field" @bind="activity.Title" />
                            </div>
                            <div>
                                <label>Activity type</label>
                                <select class="field" @bind="activity.Type">
                                    <option value="Poll">Poll</option>
                                    <option value="WordCloud">Word Cloud</option>
                                    <option value="Rating">Rating</option>
                                    <option value="Quadrant">4-Quadrant</option>
                                    <option value="FiveWhys">5-Whys</option>
                                    <option value="QnA">Q&A</option>
                                </select>
                            </div>
                            <div class="row2">
                                <div>
                                    <label>Allow anonymous</label>
                                    <select class="field" @bind="activity.AllowAnonymous">
                                        <option value="true">Yes</option>
                                        <option value="false">No</option>
                                    </select>
                                </div>
                                <div>
                                    <label>Timer</label>
                                    <select class="field" @bind="activity.Timer">
                                        <option value="0">Off</option>
                                        <option value="2">2 min</option>
                                        <option value="5">5 min</option>
                                        <option value="10">10 min</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="toolbar">
                            <button class="btn primary" @onclick='() => ShowScreen("live")'>Launch session</button>
                            <button class="btn">Save as template</button>
                        </div>
                    }
                    else
                    {
                        <p class="p">Select an activity to configure</p>
                    }
                </div>
            </div>
        }
        else if (currentWizardStep == 4)
        {
            <div class="grid">
                <div class="card solid" style="box-shadow:none">
                    <h3 class="h2">Review</h3>
                    <p class="p">Everything looks good. Generate QR and go live.</p>

                    <div class="viz" style="margin-top:12px">
                        <div class="vizhead">
                            <strong>@sessionTitle</strong>
                            <span class="chip">Expires in <strong>&nbsp;6h</strong></span>
                        </div>
                        <div class="subtle">Activities: @string.Join(" → ", activities.Select(a => a.Type))</div>
                        <div class="hr"></div>
                        <div class="toolbar">
                            <button class="btn primary" @onclick='() => ShowScreen("live")'>Go to Live Room</button>
                            <button class="btn" @onclick="OpenQrModal">Show QR / Link</button>
                        </div>
                    </div>

                    <div class="toolbar">
                        <button class="btn" @onclick="() => SetWizardStep(3)">Back</button>
                    </div>
                </div>

                <div class="card solid" style="box-shadow:none">
                    <h3 class="h2">AI readiness check</h3>
                    <p class="p">Optional hints that make your AI prompts stronger.</p>
                    <div class="list">
                        <div class="item"><strong>✅ Goal is measurable</strong><div>Clear objectives defined</div></div>
                        <div class="item"><strong>✅ Activities configured</strong><div>@activities.Count activities ready</div></div>
                    </div>
                </div>
            </div>
        }
        }
    </section>

    <!-- LIVE ROOM -->
    <section class="screen @(currentScreen == "live" ? "active" : "")" id="live">
        <div class="split">
            <aside class="card sidebar">
                <div class="title">
                    <h2 class="h2">Agenda</h2>
                    <span class="chip"><span class="dot"></span> Live</span>
                </div>

                <div class="subtle">Code: <strong>@sessionCode</strong></div>
                <div class="subtle">Participants: <strong>@liveParticipantCount</strong></div>

                <div class="list">
                    @for (int i = 0; i < activities.Count; i++)
                    {
                        var index = i;
                        var activity = activities[index];
                        <div class="item @(currentActivityIndex == index ? "active" : "")" @onclick="() => currentActivityIndex = index">
                            <strong>@(index + 1)) @activity.Type</strong>
                            <div>@activity.Title</div>
                        </div>
                    }
                </div>

                <div class="toolbar">
                    <button class="btn primary" @onclick="StartSession">Start</button>
                    <button class="btn" @onclick="NextActivity">Next</button>
                    <button class="btn primary" @onclick="NavigateToConsole">Real Console</button>
                </div>
            </aside>

            <section class="viz">
                <div class="vizhead">
                    <div>
                        <strong>@(currentActivityIndex >= 0 && currentActivityIndex < activities.Count ? activities[currentActivityIndex].Title : "Select Activity")</strong>
                        <div class="subtle">Live activity visualization</div>
                    </div>
                    <div class="tabs">
                        <button class="tab @(currentVisualization == "live" ? "on" : "")" @onclick='() => currentVisualization = "live"'>Live View</button>
                        <button class="tab @(currentVisualization == "summary" ? "on" : "")" @onclick='() => currentVisualization = "summary"'>Summary</button>
                    </div>
                </div>

                @if (currentVisualization == "live")
                {
                    <div style="padding: 20px; text-align: center; min-height: 300px; display: grid; place-items: center;">
                        @if (currentActivityIndex >= 0 && currentActivityIndex < activities.Count)
                        {
                            var activity = activities[currentActivityIndex];
                            @if (activity.Type == "WordCloud")
                            {
                                <div class="cloud">
                                    <span class="w big">innovation</span>
                                    <span class="w med">collaboration</span>
                                    <span class="w med">efficiency</span>
                                    <span class="w small">process</span>
                                    <span class="w small">improvement</span>
                                    <span class="w med">teamwork</span>
                                </div>
                            }
                            else if (activity.Type == "Quadrant")
                            {
                                <svg viewBox="0 0 400 300" width="100%" height="300" style="border-radius:18px; background: rgba(255,255,255,.65); border:1px solid rgba(15,36,56,.08);">
                                    <line x1="200" y1="10" x2="200" y2="290" stroke="rgba(15,36,56,.12)" stroke-width="2" />
                                    <line x1="10" y1="150" x2="390" y2="150" stroke="rgba(15,36,56,.12)" stroke-width="2" />
                                    <circle cx="120" cy="80" r="6" fill="rgba(43,196,138,.72)" />
                                    <circle cx="300" cy="90" r="6" fill="rgba(45,127,249,.62)" />
                                    <circle cx="280" cy="200" r="6" fill="rgba(255,176,32,.62)" />
                                    <circle cx="110" cy="210" r="6" fill="rgba(255,77,109,.55)" />
                                </svg>
                            }
                            else
                            {
                                <div>
                                    <h3>@activity.Type Activity</h3>
                                    <p>Live visualization for @activity.Title</p>
                                    <div class="subtle">Waiting for participants...</div>
                                </div>
                            }
                        }
                        else
                        {
                            <div>
                                <h3>Select an activity</h3>
                                <p>Choose an activity from the agenda to start</p>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <div style="padding: 20px;">
                        <div class="kpis">
                            <div class="kpi"><strong>@liveResponseCount</strong><span>Responses</span></div>
                            <div class="kpi"><strong>@((int)(liveParticipantCount > 0 ? (liveResponseCount * 100.0 / liveParticipantCount) : 0))%</strong><span>Participation</span></div>
                            <div class="kpi"><strong>@activities.Count</strong><span>Activities</span></div>
                        </div>
                    </div>
                }

                <div class="toolbar" style="margin-top:12px">
                    <button class="btn" @onclick='() => ShowScreen("dash")'>Open dashboards</button>
                </div>
            </section>

            <aside class="card">
                <div class="title">
                    <h2 class="h2">Facilitator tools</h2>
                    <span class="chip">AI Assist</span>
                </div>

                <div class="viz" style="padding:12px">
                    <strong>Session controls</strong>
                    <div class="toolbar" style="margin-top:8px">
                        <button class="btn" @onclick="EndSession">End Session</button>
                        <button class="btn" @onclick="ExportSession">Export Data</button>
                    </div>
                </div>
            </aside>
        </div>
    </section>

    <!-- DASHBOARDS -->
    <section class="screen @(currentScreen == "dash" ? "active" : "")" id="dash">
        <div class="grid">
            <div class="card">
                <div class="title">
                    <div>
                        <h2 class="h2">Dashboards</h2>
                        <div class="subtle">Real-time insights • Filter by join fields • Export-ready</div>
                    </div>
                    <span class="chip"><span class="dot"></span> Updating</span>
                </div>

                <div class="tabs" style="margin-top:12px">
                    <button class="tab @(currentDashboard == "overview" ? "on" : "")" @onclick='() => currentDashboard = "overview"'>Overview</button>
                    <button class="tab @(currentDashboard == "cloud" ? "on" : "")" @onclick='() => currentDashboard = "cloud"'>Word Cloud</button>
                    <button class="tab @(currentDashboard == "charts" ? "on" : "")" @onclick='() => currentDashboard = "charts"'>Charts</button>
                </div>

                @if (currentDashboard == "overview")
                {
                    <div class="viz" style="margin-top:12px">
                        <div class="kpis">
                            <div class="kpi"><strong>@dashboardResponseCount</strong><span>Total responses</span></div>
                            <div class="kpi"><strong>@dashboardParticipationRate%</strong><span>Participation rate</span></div>
                            <div class="kpi"><strong>6</strong><span>Active themes</span></div>
                        </div>
                    </div>
                }
                else if (currentDashboard == "cloud")
                {
                    <div class="viz" style="margin-top:12px">
                        <div class="cloud">
                            <span class="w big">collaboration</span>
                            <span class="w med">efficiency</span>
                            <span class="w med">innovation</span>
                            <span class="w small">process</span>
                            <span class="w small">improvement</span>
                            <span class="w med">teamwork</span>
                        </div>
                    </div>
                }
                else if (currentDashboard == "charts")
                {
                    <div class="viz" style="margin-top:12px">
                        <div style="text-align: center; padding: 40px;">
                            <strong>Interactive Charts</strong>
                            <p class="p">Poll results, rating distributions, and trend analysis will appear here</p>
                        </div>
                    </div>
                }

                <div class="toolbar" style="margin-top:12px">
                    <button class="btn">Export PDF</button>
                    <button class="btn">Export CSV</button>
                    <button class="btn primary" @onclick="EndSession">End session</button>
                </div>
            </div>

            <div class="card solid">
                <h2 class="h2">Filters & AI</h2>
                <p class="p">Use participant join fields to slice insights.</p>

                <div class="hr"></div>
                <div class="viz" style="margin-top:12px; padding:12px">
                    <strong>Key insights</strong>
                    <p class="p">
                        Based on current responses, participants are focusing on process improvements and communication efficiency.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- PARTICIPANT JOIN -->
    <section class="screen @(currentScreen == "p-join" ? "active" : "")" id="p-join">
        <div class="center">
            <div class="card phone">
                <div class="title">
                    <div>
                        <h2 class="h2">Join session</h2>
                        <div class="subtle">Enter code or use link/QR</div>
                    </div>
                    <span class="chip">@sessionCode</span>
                </div>

                <div class="form" style="margin-top:10px">
                    <div>
                        <label>Session code</label>
                        <input class="field" @bind="participantSessionCode" placeholder="e.g., TYF-4821" />
                    </div>
                    <div>
                        <label>Display name (optional)</label>
                        <input class="field" @bind="participantName" placeholder="e.g., Alex" />
                    </div>

                    <div class="row2">
                        <div>
                            <label>Team</label>
                            <select class="field">
                                <option>Ops</option>
                                <option>Tech</option>
                                <option>Finance</option>
                            </select>
                        </div>
                        <div>
                            <label>Role</label>
                            <select class="field">
                                <option>Officer</option>
                                <option>Supervisor</option>
                                <option>Manager</option>
                            </select>
                        </div>
                    </div>

                    <button class="btn primary" style="width:100%" @onclick="JoinSession">Join</button>

                    <div class="toolbar">
                        <button class="btn" @onclick='() => ShowScreen("home")'>Back to Home</button>
                        <button class="btn" @onclick="NavigateToJoin">Go to Real Join Page</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div>TechWayFit vibe • "Code it Right" • Open-source workshop companion</div>
        <div class="badge">Storage: @(UseInMemory ? "InMemory" : "SQLite") • Real-time: SignalR-ready</div>
    </footer>
</main>

<!-- QR Modal -->
<div class="modalback @(showQrModal ? "on" : "")" id="qrModal" @onclick="CloseQrModalBackdrop">
    <div class="modal">
        <div class="title">
            <h2 class="h2">Share session</h2>
            <button class="btn" @onclick="CloseQrModal">Close</button>
        </div>
        <div class="grid" style="grid-template-columns: 1fr 1fr;">
            <div class="viz" style="box-shadow:none">
                <strong>Join link</strong>
                <div class="sp"></div>
                <input class="field" @bind="shareUrl" />
                <div class="sp"></div>
                <div class="toolbar">
                    <button class="btn" @onclick="CopyShareUrl">Copy</button>
                </div>
            </div>
            <div class="viz" style="box-shadow:none; display:grid; place-items:center;">
                <div style="width: 200px; height: 200px; border-radius: 18px; background: rgba(255,255,255,.65); border: 1px solid rgba(15,36,56,.10); display: grid; place-items: center;">
                    <div style="text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 8px;">📱</div>
                        <div style="font-size: 12px; color: var(--muted);">QR Code</div>
                        <div style="font-size: 10px; color: var(--muted);">@sessionCode</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    // Screen and UI state
    private string currentScreen = "home";
    private bool showQrModal = false;
    private string selectedTemplate = "";
    private bool UseInMemory = true;

    // Session creation data
    private string sessionTitle = "Ops Pain Points Workshop — Group 1";
    private string sessionGoal = "Identify bottlenecks and quantify impact so we can prioritize fixes.";
    private string sessionCode = "TYF-4821";
    private string shareUrl = "";

    // Wizard state
    private int currentWizardStep = 1;

    // Join form fields
    private List<JoinField> joinFields = new();

    // Activities
    private List<WorkshopActivity> activities = new();
    private int selectedActivityIndex = 0;
    private int currentActivityIndex = 0;
    private string currentVisualization = "live";

    // Live session data
    private int liveParticipantCount = 18;
    private int liveResponseCount = 42;
    private bool isSessionLive = false;

    // Dashboard data
    private string currentDashboard = "overview";
    private int dashboardResponseCount = 126;
    private int dashboardParticipationRate = 82;

    // Participant join
    private string participantSessionCode = "";
    private string participantName = "";

    // Demo data
    private int SessionsCreated = 12;
    private int ParticipantsEngaged = 84;
    private int ResponsesCollected = 356;

    protected override async Task OnInitializedAsync()
    {
        shareUrl = $"{Navigation.BaseUri}join/{sessionCode}";

        // Default join fields
        joinFields.Add(new JoinField("Team", "Ops, Tech, Finance, Support"));
        joinFields.Add(new JoinField("Role", "Officer, Supervisor, Manager, Director"));

        // Default activities
        activities.Add(new WorkshopActivity("Poll", "Which step slows you down most?"));
        activities.Add(new WorkshopActivity("WordCloud", "Describe the pain in one word"));
        activities.Add(new WorkshopActivity("Quadrant", "Impact vs Effort"));
        activities.Add(new WorkshopActivity("FiveWhys", "Root cause analysis"));

        await Task.CompletedTask;
    }

    // Navigation methods
    private void ShowScreen(string screenName)
    {
        currentScreen = screenName;
        StateHasChanged();
    }

    private void SelectTemplate(string template)
    {
        selectedTemplate = template;
        LoadTemplate(template);
        StateHasChanged();
    }

    private void LoadTemplate(string template)
    {
        switch (template)
        {
            case "retro":
                sessionTitle = "Sprint Retro — Team Alpha";
                sessionGoal = "Reflect on our sprint and identify improvements for next iteration.";
                break;
            case "ops":
                sessionTitle = "Ops Pain Points Workshop — Group 1";
                sessionGoal = "Identify bottlenecks and quantify impact so we can prioritize fixes.";
                break;
            case "discovery":
                sessionTitle = "Product Discovery Session";
                sessionGoal = "Generate and prioritize new feature ideas from user feedback.";
                break;
            case "incident":
                sessionTitle = "Incident Review — System Outage";
                sessionGoal = "Analyze root causes and prevent future incidents.";
                break;
        }
    }

    private void SetWizardStep(int step)
    {
        currentWizardStep = step;
        StateHasChanged();
    }

    private void AddActivity()
    {
        activities.Add(new WorkshopActivity("Poll", "New Activity"));
        selectedActivityIndex = activities.Count - 1;
        StateHasChanged();
    }

    private void StartSession()
    {
        isSessionLive = true;
        StateHasChanged();
    }

    private void NextActivity()
    {
        if (currentActivityIndex < activities.Count - 1)
        {
            currentActivityIndex++;
            StateHasChanged();
        }
    }

    private void EndSession()
    {
        isSessionLive = false;
        ShowScreen("dash");
    }

    private void ExportSession()
    {
        _ = JS.InvokeVoidAsync("alert", "Export functionality coming soon!");
    }

    private void OpenQrModal()
    {
        showQrModal = true;
        StateHasChanged();
    }

    private void CloseQrModal()
    {
        showQrModal = false;
        StateHasChanged();
    }

    private void CloseQrModalBackdrop()
    {
        showQrModal = false;
        StateHasChanged();
    }

    private async Task CopyShareUrl()
    {
        await JS.InvokeVoidAsync("navigator.clipboard.writeText", shareUrl);
        await JS.InvokeVoidAsync("alert", "Link copied to clipboard!");
    }

    private void JoinSession()
    {
        if (!string.IsNullOrEmpty(participantSessionCode))
        {
            liveParticipantCount++;
            ShowScreen("live");
            StateHasChanged();
        }
    }

    private void NavigateToCreate() => Navigation.NavigateTo("/facilitator/create");
    private void NavigateToConsole() => Navigation.NavigateTo("/facilitator/console");
    private void NavigateToJoin() => Navigation.NavigateTo("/participant/join");

    // Data classes
    public class JoinField
    {
        public string Name { get; set; }
        public string Options { get; set; }

        public JoinField(string name, string options)
        {
            Name = name;
            Options = options;
        }
    }

    public class WorkshopActivity
    {
        public string Type { get; set; }
        public string Title { get; set; }
        public bool AllowAnonymous { get; set; } = true;
        public int Timer { get; set; } = 0;

        public WorkshopActivity(string type, string title)
        {
            Type = type;
            Title = title;
        }
    }
}
