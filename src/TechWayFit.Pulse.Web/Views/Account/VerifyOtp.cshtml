@{
  ViewData["Title"] = "Verify Code - TechWayFit Pulse";
  var email = ViewData["Email"] as string;
  var returnUrl = ViewData["ReturnUrl"] as string;
}

<main class="py-5">
  <div class="container" style="max-width: 500px;">
    <div class="card border-0 shadow-sm">
      <div class="card-body p-4">
        <div class="text-center mb-4">
          <h2 class="fw-bold mb-2">Verify Your Code</h2>
          <p class="text-muted">
            We've sent a 6-digit code to<br />
            <strong>@email</strong>
          </p>
        </div>

        @if (TempData["Error"] != null)
        {
          <div class="alert alert-danger alert-dismissible fade show" role="alert">
            @TempData["Error"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        }

        <form method="post" asp-action="VerifyOtp" asp-controller="Account">
          @Html.AntiForgeryToken()
          <input type="hidden" name="email" value="@email" />
          <input type="hidden" name="returnUrl" value="@returnUrl" />

          <div class="mb-4">
            <label for="otpCode" class="form-label fw-medium">Enter 6-Digit Code</label>
            <input type="text" class="form-control form-control-lg text-center" id="otpCode" name="otpCode"
              placeholder="000000" maxlength="6" pattern="[0-9]{6}" required autofocus
              style="letter-spacing: 0.5em; font-size: 1.5rem;" />
          </div>

          <button type="submit" class="btn btn-primary pulse-btn-primary w-100 mb-3">
            Verify & Sign In
          </button>

          <div class="text-center">
            <a href="@Url.Action("Login", "Account", new { returnUrl })" class="text-muted text-decoration-none">
              Request New Code
            </a>
          </div>
        </form>

        <hr class="my-4" />

        <div class="alert alert-info border-0 mb-0">
          <small>
            <strong>Tip:</strong> Check your spam folder if you don't see the email.
            The code expires in 10 minutes.
          </small>
        </div>
      </div>
    </div>
  </div>
</main>

@section Scripts {
  <script>
    // Auto-submit when 6 digits entered
    document.getElementById('otpCode').addEventListener('input', function (e) {
      const value = e.target.value.replace(/\D/g, '');
      e.target.value = value;

      if (value.length === 6) {
        e.target.form.submit();
      }
    });

    // Paste handling
    document.getElementById('otpCode').addEventListener('paste', function (e) {
      e.preventDefault();
      const pasteData = e.clipboardData.getData('text').replace(/\D/g, '').slice(0, 6);
      e.target.value = pasteData;

      if (pasteData.length === 6) {
        e.target.form.submit();
      }
    });
  </script>
}