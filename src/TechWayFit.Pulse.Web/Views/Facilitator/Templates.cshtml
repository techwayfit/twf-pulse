@model IReadOnlyList<TechWayFit.Pulse.Domain.Entities.SessionTemplate>

@{
    ViewData["Title"] = "Session Templates - TechWayFit Pulse";
    var userEmail = ViewData["UserEmail"] as string;
    var userName = ViewData["UserName"] as string;
}

<div class="container container-wide">
        <!-- Header -->
        <div class="mb-4">
            <h2 class="mb-2">Session Templates</h2>
            <p class="text-muted mb-0">Choose a template to quickly create a workshop session</p>
        </div>

        <!-- Alternative Creation Methods -->
        <div class="alert alert-light border d-flex align-items-center gap-3 mb-4">
            <div class="flex-grow-1">
                <div class="fw-semibold mb-1">Looking for other ways to create a session?</div>
                <small class="text-muted">Create a session manually with custom activities</small>
            </div>
            <div class="d-flex gap-2 flex-wrap">
                <a href="@Url.Action("Create", "Facilitator")" class="btn btn-sm btn-outline-primary">
                    <i class="fas fa-pencil me-1"></i>Create Manually
                </a>
            </div>
        </div>

        <!-- Filter by Category -->
        <div class="mb-4">
            <!-- Mobile: Dropdown -->
            <select class="form-select d-md-none" id="categoryFilterMobile" aria-label="Filter templates by category">
                <option value="all">All Templates</option>
                <option value="Retrospective">Retrospective</option>
                <option value="ProductDiscovery">Product Discovery</option>
                <option value="IncidentReview">Incident Review</option>
                <option value="TeamBuilding">Team Building</option>
                <option value="Training">Training</option>
            </select>
            
            <!-- Desktop: Buttons -->
            <div class="d-none d-md-flex flex-wrap gap-2" role="group" aria-label="Filter templates by category">
                <button type="button" class="btn btn-sm btn-outline-secondary active" data-filter="all">
                    All Templates
                </button>
                <button type="button" class="btn btn-sm btn-outline-secondary" data-filter="Retrospective">
                    <i class="fas fa-rotate me-1"></i>Retrospective
                </button>
                <button type="button" class="btn btn-sm btn-outline-secondary" data-filter="ProductDiscovery">
                    <i class="fas fa-lightbulb me-1"></i>Product Discovery
                </button>
                <button type="button" class="btn btn-sm btn-outline-secondary" data-filter="IncidentReview">
                    <i class="fas fa-triangle-exclamation me-1"></i>Incident Review
                </button>
                <button type="button" class="btn btn-sm btn-outline-secondary" data-filter="TeamBuilding">
                    <i class="fas fa-handshake me-1"></i>Team Building
                </button>
                <button type="button" class="btn btn-sm btn-outline-secondary" data-filter="Training">
                    <i class="fas fa-book me-1"></i>Training
                </button>
            </div>
        </div>

        <!-- System Templates -->
        @if (Model.Any(t => t.IsSystemTemplate))
        {
            <div class="mb-5">
                <h3 class="h5 mb-3 fw-semibold">
                    <i class="fas fa-star text-primary me-2"></i>
                    System Templates
                </h3>
                <div class="row g-3 g-md-4">
                    @foreach (var template in Model.Where(t => t.IsSystemTemplate).OrderBy(t => t.Name))
                    {
                        <div class="col-12 col-sm-6 col-lg-4 template-card" data-category="@template.Category">
                            <div class="card h-100 shadow-sm template-card-item position-relative">
                                <div class="card-body">
                                    <div class="d-flex align-items-start mb-3">
                                        <div class="template-icon-display fs-1 me-3" data-icon="@template.IconEmoji"></div>
                                        <div class="flex-grow-1">
                                            <h5 class="card-title mb-1">@template.Name</h5>
                                            <span class="badge bg-secondary-subtle text-secondary">@template.Category</span>
                                        </div>
                                    </div>
                                    <p class="card-text text-muted">@template.Description</p>
                                    
                                    @{
                                        var config = System.Text.Json.JsonSerializer.Deserialize<TechWayFit.Pulse.Domain.Models.SessionTemplateConfig>(template.ConfigJson);
                                        var activityCount = config?.Activities?.Count ?? 0;
                                    }
                                    
                                    <div class="d-flex align-items-center text-muted small mb-3">
                                        <i class="bi bi-list-task me-1"></i>
                                        @activityCount @(activityCount == 1 ? "Activity" : "Activities")
                                    </div>
                                </div>
                                
                                <!-- Desktop: Hover Overlay | Mobile: Always Visible Footer -->
                                <div class="template-card-overlay">
                                    <a href="@Url.Action("Create", "Facilitator", new { templateId = template.Id })" 
                                       class="btn btn-primary w-100">
                                        Use Template
                                    </a>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        }

        <!-- Custom Templates -->
        @if (Model.Any(t => !t.IsSystemTemplate))
        {
            <div class="mb-5">
                <h3 class="h5 mb-3 fw-semibold">
                    <i class="fas fa-pen text-success me-2"></i>
                    Custom Templates
                </h3>
                <div class="row g-3 g-md-4">
                    @foreach (var template in Model.Where(t => !t.IsSystemTemplate).OrderBy(t => t.Name))
                    {
                        <div class="col-12 col-sm-6 col-lg-4 template-card" data-category="@template.Category">
                            <div class="card h-100 shadow-sm template-card-item position-relative">
                                <div class="card-body">
                                    <div class="d-flex align-items-start mb-3">
                                        <div class="template-icon-display fs-1 me-3" data-icon="@template.IconEmoji"></div>
                                        <div class="flex-grow-1">
                                            <h5 class="card-title mb-1">@template.Name</h5>
                                            <span class="badge bg-secondary-subtle text-secondary">@template.Category</span>
                                        </div>
                                    </div>
                                    <p class="card-text text-muted">@template.Description</p>
                                    
                                    @{
                                        var config = System.Text.Json.JsonSerializer.Deserialize<TechWayFit.Pulse.Domain.Models.SessionTemplateConfig>(template.ConfigJson);
                                        var activityCount = config?.Activities?.Count ?? 0;
                                    }
                                    
                                    <div class="d-flex align-items-center text-muted small mb-3">
                                        <i class="bi bi-list-task me-1"></i>
                                        @activityCount @(activityCount == 1 ? "Activity" : "Activities")
                                    </div>
                                </div>
                                
                                <!-- Desktop: Hover Overlay | Mobile: Always Visible Footer -->
                                <div class="template-card-overlay">
                                    <a href="@Url.Action("Create", "Facilitator", new { templateId = template.Id })" 
                                       class="btn btn-primary w-100">
                                        Use Template
                                    </a>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        }

        <!-- No Templates Found -->
        @if (!Model.Any())
        {
            <div class="text-center py-5">
                <div class="fs-1 mb-3"><i class="fas fa-file-lines"></i></div>
                <h5 class="text-muted">No templates available</h5>
                <p class="text-muted">System templates will be initialized on first application startup.</p>
            </div>
        }
    </div>

@section Scripts {
    <script>
        // Render template icons using IconHelper
        document.addEventListener('DOMContentLoaded', function() {
            if (window.IconHelper) {
                const iconElements = document.querySelectorAll('.template-icon-display[data-icon]');
                iconElements.forEach(element => {
                    const iconValue = element.getAttribute('data-icon');
                    if (iconValue) {
                        element.innerHTML = IconHelper.toFontAwesome(iconValue);
                    }
                });
            }
        });

        // Template filtering function
        function filterTemplates(filterValue) {
            const cards = document.querySelectorAll('.template-card');
            cards.forEach(card => {
                if (filterValue === 'all' || card.dataset.category === filterValue) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Desktop: Button filtering
        document.querySelectorAll('[data-filter]').forEach(button => {
            button.addEventListener('click', function() {
                // Update active button
                document.querySelectorAll('[data-filter]').forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                
                filterTemplates(this.dataset.filter);
            });
        });

        // Mobile: Dropdown filtering
        const mobileSelect = document.getElementById('categoryFilterMobile');
        if (mobileSelect) {
            mobileSelect.addEventListener('change', function() {
                filterTemplates(this.value);
            });
        }
    </script>
}
